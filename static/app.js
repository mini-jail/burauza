var fe=Symbol(),Te=new Set,k,g;function y(e){let t=$();g=t;try{return X(()=>{let n;return e.length&&(n=U.bind(void 0,t,!0)),e(n)})}catch(n){Q(n)}finally{g=t.parentNode}}function $(e,t){let n={value:e,parentNode:g,children:void 0,injections:void 0,cleanups:void 0,callback:t,sources:void 0,sourceSlots:void 0};return g&&(g.children===void 0?g.children=[n]:g.children.push(n)),n}function B(e){A(()=>j(e))}function _(e){C(()=>j(e))}function w(e,t){return n=>(e(),j(()=>t(n)))}function A(e,t){if(g){let n=$(t,e);k?k.add(n):queueMicrotask(()=>Y(n,!1))}else queueMicrotask(()=>e(t))}function K(e,t){return e?e.injections&&t in e.injections?e.injections[t]:K(e.parentNode,t):void 0}function pe(e){return{value:e,nodes:void 0,nodeSlots:void 0}}function Le(e){if(g&&g.callback){let t=e.nodes?.length||0,n=g.sources?.length||0;g.sources===void 0?(g.sources=[e],g.sourceSlots=[t]):(g.sources.push(e),g.sourceSlots.push(t)),e.nodes===void 0?(e.nodes=[g],e.nodeSlots=[n]):(e.nodes.push(g),e.nodeSlots.push(n))}return e.value}function Me(e,t){typeof t=="function"&&(t=t(e.value)),e.value=t,e.nodes?.length&&X(()=>{for(let n of e.nodes)k.add(n)})}function He(e,t){return arguments.length===1?Le(e):Me(e,t)}function d(e){let t=pe(e);return He.bind(void 0,t)}function Q(e){let t=K(g,fe);if(!t)return reportError(e);for(let n of t)n(e)}function C(e){g!==void 0&&(g.cleanups?g.cleanups.push(e):g.cleanups=[e])}function j(e){let t=g;g=void 0;let n=e();return g=t,n}function X(e){if(k)return e();k=Te;let t=e();return queueMicrotask(he),t}function he(){if(k!==void 0){for(let e of k)k.delete(e),Y(e,!1);k=void 0}}function Y(e,t){if(U(e,t),e.callback===void 0)return;let n=g;g=e;try{e.value=e.callback(e.value)}catch(s){Q(s)}finally{g=n}}function ve(e){let t,n,s,i;for(;e.sources.length;)t=e.sources.pop(),n=e.sourceSlots.pop(),t.nodes?.length&&(s=t.nodes.pop(),i=t.nodeSlots.pop(),n<t.nodes.length&&(t.nodes[n]=s,t.nodeSlots[n]=i,s.sourceSlots[i]=n))}function Ee(e,t){let n=e.callback!==void 0,s;for(;e.children.length;)s=e.children.pop(),U(s,t||n&&s.callback!==void 0)}function U(e,t){e.sources?.length&&ve(e),e.children?.length&&Ee(e,t),e.cleanups?.length&&ke(e),e.injections=void 0,t&&Se(e)}function ke(e){for(;e.cleanups?.length;)e.cleanups.pop()()}function Se(e){e.value=void 0,e.parentNode=void 0,e.children=void 0,e.cleanups=void 0,e.callback=void 0,e.sources=void 0,e.sourceSlots=void 0}var N,z,H;function P(){return H}function r(e,t){let n=document.createElement(e);t&&Ve(n,t),Ce(n)}function R(e,t){return y(n=>{let s=H;return H=e,t(),H=s,n})}function h(e){if(H===void 0)return e();let t=H.appendChild(new Text);A(n=>{let s=z=[];return e(),xe(t,n,s),z=void 0,s.length>0?s:void 0})}function T(e){return(...t)=>y(()=>e(...t))}function xe(e,t,n){let s=e.parentNode;if(t===void 0){for(let f of n)s.insertBefore(f,e);return}let i=t.length,c=n.length,a,o,l;e:for(o=0;o<c;o++){for(a=t[o],l=0;l<i;l++)if(t[l]!==void 0&&(t[l].nodeType===3&&n[o].nodeType===3?(t[l].data!==n[o].data&&(t[l].data=n[o].data),n[o]=t[l]):t[l].isEqualNode(n[o])&&(n[o]=t[l]),n[o]===t[l])){if(t[l]=void 0,o===l)continue e;break}s.insertBefore(n[o],a?.nextSibling||null)}for(;t.length;)t.pop()?.remove()}function J(e){return e.replace(/([A-Z])/g,t=>"-"+t[0]).toLowerCase()}function ye(e){return e.startsWith("on:")?e.slice(3):e.slice(2).toLowerCase()}function Ne(e,t,n){for(let s in n){let i=n[s];typeof i=="function"?A(c=>{let a=i();return a!==c&&(e[t][s]=a||null),a}):e[t][s]=i||null}}function we(e,t,n){A(s=>{let i=n();return i!==s&&Z(e,t,i),i})}function Z(e,t,n){typeof n=="function"&&!t.startsWith("on")?we(e,t,n):typeof n=="object"?Ne(e,t,n):t==="textContent"?e.firstChild?.nodeType===3?e.firstChild.data=String(n):e.prepend(String(n)):t in e?e[t]=n:t.startsWith("on")?e.addEventListener(ye(t),n):n!=null?e.setAttributeNS(null,J(t),String(n)):e.removeAttributeNS(null,J(t))}function Ce(e){H===void 0?z?.push(e):H?.appendChild(e)}function Ve(e,t){let n=H,s=N;if(H=e,N=t.length?{}:void 0,t(N),H=void 0,N)for(let i in N)Z(e,i,N[i]);H=n,N=s}var Ge=await Pe(),L=d(Be()),W=y(()=>{let e=()=>[...Ge,...L()];return A(t=>{let n=L();if(t===!0)return!1;localStorage.setItem("sources",JSON.stringify(n))},!0),e});function Be(){let e=localStorage.getItem("sources")||"[]";try{return JSON.parse(e)}catch{return[]}}async function Pe(){try{return await(await fetch("./sources.json")).json()}catch{return[]}}function ee(){return W()}function Re(e){return W().find(t=>t.url===e)}function te(){return W()[0]}function ne(e){let t=d([]);return A(async()=>{let{page:n=1,limit:s=40,url:i,tags:c}=e(),a=[],o=Re(i)?.url||i;if(o){let l=new URL(o),f=new URLSearchParams;f.set("page",n.toString()),f.set("limit",s.toString()),c?.length&&f.set("tags",c.join(" ")),l.search=f.toString();let p=await fetch(l);if(p.ok){let u=await p.json();for(let m of(Array.isArray(u)?u:u.post)||[])m.id!==void 0&&m.file_url!==void 0&&(m.preview_url===void 0&&m.preview_file_url===void 0||a.push(Ie(i,m)))}}t(a)}),t}function Ie(e,t){let n={id:t.id,fileUrl:t.file_url,previewUrl:t.preview_url||t.preview_file_url,tags:[],source:e};return(t.tags||t.tag_string)&&(n.tags=(t.tags||t.tag_string).split(" ").filter(s=>s)),n}function se(e){let t=document.title;A(()=>document.title=e()),_(()=>document.title=t)}var re=()=>{let e=location.hash;return e.startsWith("#")&&(e=e.slice(1)),e},ie=()=>{let e=new URLSearchParams(re());return{url:e.has("url")?e.get("url"):te()?.url,page:e.has("page")?~~e.get("page"):1,limit:e.has("limit")?~~e.get("limit"):40,search:e.has("search")?e.get("search"):"",tags:e.has("tags")?e.get("tags").split(",").filter(t=>t):[]}},S=y(()=>{let e=ie(),t=d(e.url),n=d(e.limit),s=d(0),i=d(1/0),c=d(e.search),a=d([]),o=d(e.tags),l=d(e.page),f=d(),p=ne(()=>({url:t(),limit:n(),page:l(),tags:o()})),u=()=>{let b=[];for(let v of p())for(let E of v.tags)b.includes(E)===!1&&b.push(E);return b.sort((v,E)=>v<E?-1:v>E?1:0)},m=b=>!F(b)&&o([...o(),b]),M=b=>o(o().filter(v=>v!==b)),x=b=>F(b)?M(b):m(b),F=b=>o().includes(b),me=()=>(t(),o(),void 0),q=()=>{let b=ie();t(b.url),l(b.page),n(b.limit),c(b.search),o(b.tags)};return A(w(c,b=>{if(b!==c()){let v=c().split(" ").filter(E=>E);for(let E of v)m(E);l(1)}return c()}),e.search),se(()=>{let b=`\u30D6\u30E9\u30A6\u30B6\uFF1A${l()}`;return o().length&&(b+=` \u300C${o().join("\u3001 ")}\u300D`),b}),A(w(p,()=>{i(p().length),s(0)})),A(w(me,b=>{let v=`${t()}${o().join()}`;return b!==v&&l(1),v}),`${t()}${o().join()}`),A(b=>(b.set("page",l().toString()),b.set("limit",n().toString()),b.set("url",t()),c().length?b.set("search",c()):b.delete("search"),o().length?b.set("tags",o().join(",")):b.delete("tags"),removeEventListener("popstate",q),location.hash=b.toString(),addEventListener("popstate",q),b),new URLSearchParams(re())),{highlighted:a,tags:o,posts:p,postTags:u,page:l,select:f,addTag:m,delTag:M,hasTag:F,toggleTag:x,search:c,loaded:s,size:i,limit:n,url:t}});function ae(){let e=localStorage.getItem("is:pervert")==="true",t="imapervert".split(""),n=d(e),s=0,i=({key:c})=>{if(s===t.length-1){localStorage.setItem("is:pervert","true"),n(!0);return}c!=null&&t[s]!=null&&c.toLowerCase()===t[s].toLowerCase()?s++:(s=0,n(!1))};return A(()=>{C(()=>removeEventListener("keyup",i)),!n()&&addEventListener("keyup",i)}),n}function oe(e,t){return new Promise(n=>{let s=document.createElement("input");s.type="file",s.accept=e,s.onchange=i=>{let c=i.currentTarget.files;if(c===null)return;let a=new FileReader;a.onload=()=>{n(a.result)},a[t](c[0])},s.click()})}function ce(e,t,n){let s=`${t};charset=utf-8,${encodeURIComponent(n)}`,i=document.createElement("a");i.href="data:"+s,i.download=e,i.click()}function De(e){let t=d(!1),n=d(!1);A(()=>t(e.show())),A(()=>{t()?e.onOpen?.():e.onClose?.()}),r("div",s=>{s.show=t,s.class="window",s.fullscreen=n,s.style={width:e.width,height:e.height},r("div",i=>{i.class="window-title",r("h3",c=>{c.textContent=e.title,c.title=e.title}),r("div",c=>{c.class="window-title-children",e.titleChildren&&h(e.titleChildren),r("button",a=>{a.class=()=>`icon ${n()?"compress":"enlarge"}`,a.title=()=>`${n()?"compress":"enlarge"} window`,a.onClick=()=>n(!n())}),r("button",a=>{a.class="icon close",a.title="close window",a.onClick=()=>t(!1)})})}),r("div",i=>{i.class="window-content",r("div",c=>{c.class="window-content-wrapper",h(e.children)})})})}var I=T(De);var le=T(e=>{I({title:()=>"source editor",show:e,titleChildren(){r("button",t=>{t.class="icon download-json",t.title="download sources",t.onClick=()=>ce(`sources-${Date.now()}.json`,"application/json",JSON.stringify(L(),null,2))})},children(){for(let t of L())Fe(t);Oe()}})}),Oe=T(()=>{let e=d(""),t=d("");r("div",n=>{n.class="flex justify-content-space-betwee flex-gap-10",r("div",s=>{s.class="flex align-items-baseline width-100",r("label",i=>i.textContent="name:"),r("input",i=>{i.class="flex-1",i.name="name",i.value=e,i.onInput=c=>e(c.currentTarget.value),i.placeholder="*Booru"})}),r("div",s=>{s.class="flex align-items-baseline width-100",r("label",i=>i.textContent="url:"),r("input",i=>{i.class="flex-1",i.name="url",i.value=t,i.onInput=c=>t(c.currentTarget.value),i.placeholder="https://..."})}),r("div",s=>{s.class="flex",r("button",i=>{i.class="icon plus",i.title="add source",i.disabled=()=>!e()||!t(),i.onClick=()=>{!e()||!t()||(L(L().concat({name:e(),url:t()})),t(""),e(""))}}),r("button",i=>{i.class="icon import",i.title="import source",i.onClick=async()=>{let c=await oe(".json","readAsText"),a=JSON.parse(c),o=[];if(Array.isArray(a))for(let l of a)l.name&&l.url&&o.push(l);L(L().concat(o))}})})})}),Fe=T(e=>{r("div",t=>{t.class="flex justify-content-space-between flex-gap-10",r("div",n=>{n.class="flex align-items-baseline width-100",r("label",s=>s.textContent="name:"),r("input",s=>{s.class="flex-1",s.name="name",s.value=e.name,s.placeholder="*Booru",s.onInput=i=>e.name=i.currentTarget.value})}),r("div",n=>{n.class="flex align-items-baseline width-100",r("label",s=>s.textContent="url:"),r("input",s=>{s.class="flex-1",s.value=e.url,s.placeholder="https://...",s.onInput=i=>e.url=i.currentTarget.value})}),r("div",n=>{n.class="flex",r("button",s=>{s.class="icon check",s.title="save source",s.onClick=()=>{let i={url:e.url,name:e.name};L(L().filter(c=>c!==e).concat(i))}}),r("button",s=>{s.class="icon delete",s.title="delete source",s.onClick=()=>{L(L().filter(i=>i!==e))}})})})});var D=new Map;function ue(e,t){let n=d(e);return A(w(t,async()=>{if(t()===!1)return n(e);if(D.has(e))return n(D.get(e));let s=await fetch(`https://danbooru.donmai.us/wiki_pages/${e}.json`);s.status===200?D.set(e,(await s.json()).body):D.set(e,e)})),n}var je=T(e=>{let{toggleTag:t,tags:n,highlighted:s}=S,i=d(!1),c=ue(e,i);r("div",a=>{a.textContent=e,a.class="tag",a.title=c,a.onClick=()=>t(e),a.onMouseOver=()=>i(!0),a.onMouseOut=()=>i(!1),a.state=()=>{if(n().includes(e))return"active";if(s().includes(e))return"highlight"}})}),V=je;var Ue=T(()=>{let{postTags:e,tags:t,page:n,search:s,url:i}=S,c=d(!1),a=d(!1),o=ae();r("nav",()=>{let l=P();le(a),r("div",f=>{f.class="nav-top",r("div",p=>{p.class="flex align-items-center",h(()=>{o()!==!1&&r("button",u=>{u.title="choose image source",u.name="source",u.type="button",u.class="icon source z-index-1",r("div",m=>{m.class="sources",r("div",M=>{M.title="open source editor",M.textContent="source editor",M.onClick=()=>a(!a())});for(let M of ee())r("div",x=>{x.active=()=>M.url===i(),x.textContent=M.name,x.onClick=()=>i(M.url)})})})}),r("button",u=>{u.class="icon tags",u.onClick=()=>c(!c())}),r("input",u=>{u.class="flex-1",u.name="search",u.placeholder="search...",u.value=s,u.type="text";let m;u.onKeyUp=M=>{let x=M.currentTarget.value;clearTimeout(m),m=setTimeout(()=>s(x),1e3)}}),r("button",u=>{u.title="browse source",u.name="sourcecode",u.type="button",u.class="icon sourcecode",u.onClick=()=>{open("https://github.com/mini-jail/burauza","_blank")}})}),r("div",p=>{p.class="nav-paging",r("button",u=>{u.class="previous",u.textContent=()=>String(n()-1),u.disabled=()=>n()<=1,u.onClick=()=>n(n()-1)}),r("button",u=>{u.class="current",u.disabled=!0,u.textContent=()=>String(n())}),r("button",u=>{u.class="next",u.textContent=()=>String(n()+1),u.onClick=()=>n(n()+1)})})}),r("div",f=>{f.class="tag-list overflow-auto flex-1",f.show=c,h(()=>{let p=t(),u=e().filter(m=>!p.includes(m));B(()=>l.scrollTo({top:0,behavior:"smooth"}));for(let m of p)V(m);for(let m of u)V(m)})})})}),be=Ue;var G=d(new Set);function de(){let e;R(document.body,()=>{r("div",t=>{t.class="loading-wrapper",h(()=>{for(let n of G())r("div",s=>{s.class="loading",s.textContent=n.text,s.loading=()=>{let i=n.on();return clearTimeout(e),n.on()&&(G().delete(n),e=setTimeout(()=>G(c=>c),2e3)),i}})})})})}function O(e){queueMicrotask(()=>{G(G().add(e))})}var ze=["jpg","jpeg","bmp","png","gif"],We=e=>e.split(".").at(-1),qe=e=>{let t=We(e);return t===void 0?!1:ze.includes(t)},$e=T(()=>{let{select:e,posts:t}=S,n=d(!1);A(()=>{C(()=>n(!1))});let s=a=>{a.key==="ArrowRight"?c():a.key==="ArrowLeft"&&i()},i=()=>{let a=t().indexOf(e()),o=a-1===-1?t().length-1:a-1;e(t()[o])},c=()=>{let a=t().indexOf(e()),o=a+1===t().length?0:a+1;e(t()[o])};I({title:()=>String(e()?.fileUrl),show:n,width:"100%",onOpen:()=>addEventListener("keyup",s),onClose:()=>removeEventListener("keyup",s),titleChildren(){r("button",a=>{a.class="icon left",a.onClick=i}),r("button",a=>{a.class="icon right",a.onClick=c}),r("button",a=>{a.class="icon curly-arrow",a.title="open file in new tab",a.onClick=()=>open(e().fileUrl,"_blank")})},children(){r("div",a=>{a.class="preview",h(()=>{let o=e();o!==void 0&&(O({on:n,text:()=>`loading "${o.id}"`}),r("img",l=>{l.class="preview-img",l.src=qe(o.fileUrl)?o.fileUrl:o.previewUrl,l.alt=o.fileUrl,l.onLoad=()=>n(!0),l.onError=f=>{f.currentTarget.src===o.fileUrl&&(f.currentTarget.src=o.previewUrl)}}),r("div",l=>{l.class="tag-list";for(let f of o.tags)V(f)}))})})}})}),ge=$e;var _e=T(()=>{let{posts:e,highlighted:t,select:n,loaded:s,size:i}=S;r("main",c=>{let a=P();c.ready=()=>i()<=s(),h(()=>{O({on:()=>i()<=s(),text:()=>`loading posts ${s()}/${i()}`}),B(()=>a.scrollTo({top:0,behavior:"smooth"}));for(let o of e())r("article",()=>{r("img",l=>{l.src=o.previewUrl,l.alt=l.src,l.onClick=()=>n(o),l.onLoad=()=>s(s()+1),l.onError=l.onLoad,l.onMouseOver=()=>t(o.tags),l.onMouseOut=()=>t([])})})})})}),Ae=_e;var Ke=T(()=>{be(),Ae(),ge()});R(document.body,()=>{de(),Ke()});
//# sourceMappingURL=app.js.map
